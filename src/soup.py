from googlesearch import search_news
from bs4 import BeautifulSoup
from newspaper import Article
import requests
def func(tag):
    return None if tag ==None else tag.text.strip().replace("\n","").replace("\t","")
def soup(url):
    #1
    news = Article(url, language='en')
    news.download()
    news.parse()
    malware_info = {}
    malware_info['url'] = url
    malware_info['author'] = None
    malware_info['p_date'] = None
    malware_info['source'] = None
    malware_info['tpe'] = None
    malware_info['title'] = news.title
    data =  requests.get(url)
    soup = BeautifulSoup(data.text,'lxml')
    if 'threatpost.com' in url:
        date = soup.find(name='div',attrs={"class":"c-article__time"})
        malware_info['p_date'] = func(date)
        author = soup.find(name='a',attrs={"class":"c-article__author-name"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'Threatpost'
        malware_info['tpe'] ='news'
        return malware_info
    #2    
    elif 'adtmag.com' in url:
        date = soup.find(name='li',attrs={"class":"date"})
        malware_info['p_date']=func(date)
        author = soup.find(name='li',attrs={"class":"author"})
        malware_info['author'] = func(author)[3:]
        malware_info['source'] ='ADT Magazine'
        malware_info['tpe'] = 'news'
        return malware_info
    #3
    elif 'silicon' in url:
        date = soup.find(name='time',attrs={"class":"entry-date"})
        malware_info['p_date'] = func(date)
        author = soup.find(name='a',attrs={"class":"url fn n"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'Silicon UK'
        malware_info['tpe'] ='news'
        return malware_info
    #4
    elif 'searchsecurity.techtarget.com' in url:
        date = soup.find(name='span',attrs={"class":"comment-date"})
        malware_info['p_date'] = func(date)[2:]
        author =soup.find(name='div',attrs={"class":"main-article-author-byline"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'TechTarget'
        malware_info['tpe'] ='news'
        return malware_info
    #5
    elif 'www.digitaltrends.com' in url:
        date = soup.find(name='time',attrs={"class":"date dtreviewed"})
        for i in date.find_all(attrs = {"class":"long"}):
            malware_info['p_date'] = func(i)
        author = soup.find(name='a',attrs={"class":"author url fn"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'Digital Trends'
        malware_info['tpe'] ='news'
        return malware_info

    #6
    elif 'bleepingcomputer.com' in url:
        date = soup.find(name='li',attrs={"class":"cz-news-date"})
        malware_info['p_date'] =  func(date)
        author = soup.find(name='a',attrs={"rel":"author"})
        malware_info['author'] = func(author)  
        malware_info['source'] = 'BleepingComputer'
        malware_info['tpe'] ='news'
        return malware_info
    #7
    elif 'esecurityplanet.com' in url:
        date = soup.finddate = soup.find(name='span',attrs={"itemprop":"datePublished"})
        malware_info['p_date'] = func(date)[7:]
        author = soup.find(name='span',attrs={"itemprop":"name"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'eSecurity Planet'
        malware_info['tpe'] ='news'
        return malware_info
    #8
    elif 'nakedsecurity.sophos.com' in url:
        date = soup.find(name='time',attrs={"class":"entry-date published"})
        malware_info['p_date'] = func(date)
        author = soup.find(name='a',attrs={"class":"author url fn"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'Naked Security'
        malware_info['tpe'] ='news'
        return malware_info
    #9
    elif 'securityintelligence.com' in url:

        date = soup.find(name='span',attrs={"class":"date-time"})
        malware_info['p_date'] = func(date)
        author = soup.find(name='div',attrs={"class":"author-header"})
        i  = author.find(name = 'a')
        malware_info['author'] = func(i)
        malware_info['source'] = 'Security Intelligence'
        malware_info['tpe'] ='blog'
        return malware_info
    #10
    elif 'www.wired.com' in url:
        tag = soup.find(name="ul",attrs={"class":"meta-list"})
        for i in tag.find_all(name='time',attrs={"class":"date-mdy"}):
            malware_info['p_date'] = func(i)
        for j in tag.find_all(name='a',attrs={"rel":"author","class":"byline-component__link"}):
            malware_info['author'] = func(j)
        malware_info['source'] = 'WIRED'
        malware_info['tpe'] ='news'
        return malware_info
    #11
    elif 'ibtimes.co.uk' in url:
        date = soup.find(name='time',attrs={"class":"time-format","itemprop":"datePublished"})
        malware_info['p_date'] = func(date)
        author = soup.find(name='a',attrs={"class":"reporter-name","rel":"author"})
        malware_info['p_date'] = func(author)
        malware_info['source'] = 'International Business Times UK'
        malware_info['tpe'] ='blogs'
        return malware_info
    #12
    elif 'hothardware.com' in url:
        date = soup.find(name='span',attrs={"class":"dt-published"})
        malware_info['p_date'] = func(data)
        author = soup.find(name='a',attrs={"class":"p-author"})
        malware_info['p_date'] = func(author)
        malware_info['source'] = 'Hot Hardware'
        malware_info['tpe'] ='news'
        return malware_info
    #13
    elif 'krebsonsecurity.com' in url:
        date = soup.find(name='div',attrs={"class":"post-smallerfont"})
        i = date.find(name = 'small')
        malware_info['p_date'] = func(i)[2:]
        author = soup.find(name='div',attrs={"id":"header"})
        i = author.find(name = 'h1')
        malware_info['author'] = func(i)
        malware_info['source'] = 'Krebs on Security'
        malware_info['tpe'] ='news'
        return malware_info
    #14
    elif 'forbes.com' in url:

        author = soup.find(name='div',attrs={"class":"fs-author-wrapper"})
        malware_info['author'] = func(author)[15:]
        malware_info['source'] = 'Forbes'
        malware_info['tpe'] ='news'
        return malware_info
    #15
    elif 'theregister.co.uk' in url:
        date = soup.find(name ='span',attrs={"class":"dateline"})
        malware_info['p_date'] = func(date)
        author = soup.find(name='a',attrs={"class":"alt_colour dcl","title":"Read more by this author"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'The Register'
        malware_info['tpe'] ='news'
        return malware_info
    #16
    # elif 'dataprotectionreport' in url:
        # date = soup.find(name ='span',attrs={"class":"post-byline"} )
        # malware_info['p_date'] = func(tag)date.text.text())
        #date = soup.find():
        #     malware_info['p_date'] = func(tag)tag)
        # author = soup.find(name='span',attrs={"class":"post-categories"})
        # author = soup.find(name='a')
        # malware_info['p_date'] = func(tag)func(author))
    #17
    # elif 'voicebot.ai' in url:
        #date = soup.find():
        #      malware_info['p_date'] = func(tag)tag)
        # date = soup.find(name ='time',attrs={"class":"article_time"} )
        # malware_info['p_date'] = func(tag)func(date))
        # author = soup.find(name='span',attrs={"itemprop":"name"})
        # malware_info['p_date'] = func(tag)func(author))
    #18
    elif 'pcmag.com' in url:
        date = soup.find(name ='li',attrs={"class":"hide-for-small-only"} )
        malware_info['p_date'] = func(date)
        author = soup.find(name='span',attrs={"class":"fn","itemprop":"name"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'PCMag'
        malware_info['tpe'] ='news'
        return malware_info
    #19
    elif 'hackread.com' in url:
        date = soup.find(name ='time',attrs={"class":"entry-date"} )
        malware_info['p_date'] = func(date)
        author = soup.find(name='span',attrs={"class":"entry-author"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'HackRead'
        malware_info['tpe'] ='news'
        return malware_info
    #20
    elif "cyberscoop.com" in url:
        date = soup.find(name ='span',attrs={"class":"article__meta"} )
        malware_info['p_date'] = func(date)
        author = soup.find(name='a',attrs={"class":"author url fn"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'CyberScoop'
        malware_info['tpe'] ='news'
        return malware_info

    #21
    elif "bankinfosecurity.com" in url:
        date = soup.find(name ='span',attrs={"class":"text-nowrap"})
        malware_info['p_date'] = func(date)
        author = soup.find(name='a',attrs={"class":"author-link"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'BankInfoSecurity.com'
        malware_info['tpe'] ='news'
        return malware_info

    # 22
    elif "techradar.com" in url:
        date = soup.find(name ='time',attrs={"class":"no-wrap relative-date chunk"} )
        malware_info['p_date'] = func(date)
        author = soup.find(name='a',attrs={"rel":"author"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'TechRadar'
        malware_info['tpe'] ='news'
        return malware_info
    # 23
    # 24
    elif "itproportal.com" in url:
        date = soup.find(name ='time',attrs={"class":"no-wrap relative-date chunk"} )
        malware_info['p_date'] = func(date)
        author = soup.find(name='a',attrs={"rel":"author"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'ITProPortal'
        malware_info['tpe'] ='news'
        return malware_info
    # 25
    elif "thecyberwire.com" in url:
        #date = soup.find():
        #     malware_info['p_date'] = func(tag)tag)
        date = soup.find(name ='h3',attrs={"class":"dateline"} )
        malware_info['p_date'] = func(date)
        author = soup.find(name='h1',attrs={"class":"title"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'The CyberWire'
        malware_info['tpe'] ='news'
        return malware_info

    # 26
    elif "biztechmagazine.com" in url:
        # date = soup.find(name ='div',attrs={"class":"pw-widget __pw-theme-default pw-widget-6ae3c __pw-size-32 __pw-hover-false __pw-layout-vertical __pw-padding-false __pw-view-auto __pw-label-false __pw-counter-none "} )
        # malware_info['p_date'] = func(tag)func(date))
        author = soup.find(name='a',attrs={"rel":"author"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'BizTech Magazine'
        malware_info['tpe'] ='news'
        return malware_info
    # 27
    elif "pcworld.com" in url:
        date = soup.find(name ='span',attrs={"class":"pub-date","itemprop":"datePublished"} )
        malware_info['p_date'] = date['content']
        author = soup.find(name='span',attrs={"itemprop":"name"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'PCWorld'
        malware_info['tpe'] ='news'
        return malware_info
    # 28
    elif "informationweek.com" in url:
        date = soup.find(name ='span',attrs={"class":"maller gray"} )
        malware_info['p_date'] = func(date)
        author = soup.find(name='span',attrs={"class":"smaller blue"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'InformationWeek'
        malware_info['tpe'] ='news'
        return malware_info
    # 29
    elif "commercialintegrator.com" in url:
        tag = soup.find(name = "div",attrs={"class":"header-border"})
        malware_info['p_date'] = func(tag.find("time"))
        author = tag.find(name = 'span',attrs = {"class":"author-name"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'Commercial Integrator'
        malware_info['tpe'] ='news'
        return malware_info
    # 30
    elif "ecurity-insider" in url:
        date = soup.find(name ='time',attrs={"pubdate":"pubdate"} )
        malware_info['p_date'] = func(date)
        author = soup.find(name='p',attrs={"id":"autor"})
        author = author.find("a")
        malware_info['author'] = func(author)
        malware_info['source'] = 'Security-Insider'
        malware_info['tpe'] ='news'
        return malware_info
    # 31
    elif "vice.com" in url:
        date = soup.find(name ='div',attrs={"class":"article__contributions__publishdate"} )
        malware_info['p_date'] = func(date)
        author = soup.find(name='a',attrs={"class":"contributor__link hed-xs"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'VICE News'
        malware_info['tpe'] ='news'
        return malware_info

    elif "arstechnica.com" in url:
        date = soup.find(name ='time',attrs={"class":"date"} )
        malware_info['p_date'] = func(date)
        author = soup.find(name='span',attrs={"itemprop":"name"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'Ars Technica'
        malware_info['tpe'] ='news'
        return malware_info
    elif "techgenix.com" in url:
        date = soup.find(name ='span',attrs={"class":"post_info_date"} )
        malware_info['p_date'] = func(date)
        author = soup.find(name='span',attrs={"class":"post_info_author"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'TechGenix'
        malware_info['tpe'] = 'blog'
        return malware_info
    elif "internetofthingsagenda.techtarget.com" in url:
        author = soup.find(name='div',attrs={"class":"main-article-author-byline"})
        malware_info['author'] = func(author)
        malware_info['source'] = 'TechTarget'
        malware_info['tpe'] = 'blog'
        return malware_info
    elif "ericsson.com" in url:
        date = soup.find(name ='h6',attrs={"class":"content-title blog-post-date"} )
        author = soup.find(name='div',attrs={"class":"author"})
        malware_info['author'] = func(author).splitlines()[0]
        malware_info['p_date'] = func(date)
        malware_info['source'] = 'Ericsson'
        malware_info['tpe'] = 'blog'
        return malware_info
    elif "internetofbusiness.com" in url:
        date = soup.find(name ='span',attrs={"class":"td-post-date"})
        author = soup.find(name='div',attrs={"class":"td-post-author-name"})
        malware_info['author'] = func(author)[3:-2]
        malware_info['p_date'] = func(date)
        malware_info['source'] = 'The Internet of Business'
        malware_info['tpe'] = 'blog'
        return malware_info
    elif "cio.co.ke" in url:
        date = soup.find(name ='span',attrs={"class":"td-post-date"})
        author = soup.find(name='div',attrs={"class":"td-post-author-name"})
        malware_info['author'] = func(author)[3:-2]
        malware_info['p_date'] = func(date)
        malware_info['source'] = 'CIO East Africa'
        malware_info['tpe'] = 'blog'
        return malware_info
    elif "www.welivesecurity.com" in url:
        author = soup.find(name='a',attrs={"class":"author url fn"})
        date = author.find_next()
        malware_info['author'] = func(author)
        malware_info['p_date'] = func(date)
        malware_info['source'] = 'We Live Security'
        malware_info['tpe'] = 'blog'
        return malware_info
    elif "securityweek.com" in url:
        tag = soup.find(name='div',attrs={"class":"submitted"})
        a  = func(tag).split('\n')[0].split(' on ')
        malware_info['author'] = a[0]
        malware_info['p_date'] = a[1]
        malware_info['source'] = 'securityweek'
        malware_info['tpe'] = 'news'
        return malware_info
    elif "chepicap.com" in url:
        date = soup.find(name ='div',attrs={"class":"date"})
        author = soup.find(name='span',attrs={"class":"author_name"})
        malware_info['author'] = func(author)
        malware_info['p_date'] = func(date)
        malware_info['source'] = 'chepicap'
        malware_info['tpe'] = 'news'
        return malware_info
    else :
        return False
    
